version: 1.0
runtime: ruby31
build:
  env:
    - name: DEMO_DATABASE_CONN
      value: "something"
    - name: DEMO_DATABASE_USER
      value: "demo"
    - name: DEMO_DATABASE_PASSWORD
      value: "password"
  commands:
    build:
      - sudo amazon-linux-extras enable postgresql14
      - yum install -y libyaml-devel postgresql postgresql-server postgresql-devel
      - bundle install
      - RAILS_ENV=production bundle exec rails db:create db:migrate
run:
  runtime-version: 3.1.4
  env:
    - name: DEMO_DATABASE_CONN
      value: "book-demo"
    - name: DEMO_DATABASE_USER
      value: "demo"
    - name: DEMO_DATABASE_PASSWORD
      value: "demoRails1"
  command: bundle exec rails s -p 8080
  network:
    port: 8080
    env: APP_PORT

